## Знакомство с Docker
**Docker** – это платформа, которая позволяет «создавать, поставлять и запус­ кать любое приложение повсюду»

**Чем хорош Docker?**
- Замена виртуальных машин
- Прототипирование программного обеспечения
- Упаковка программного обеспечения
- Возможность для архитектуры микросервисов
- Моделирование сетей
- Возможность производительности полного стека в автономном режиме
- Сокращение неизбежных расходов на отладку
- Документирование зависимостей программного обеспечения и точки взаимодействия
- Возможность непрерывной доставки

**Ключевые команды Docker**

**Основная функция Docker** – создавать, отправлять и запускать программное обеспечение в любом месте, где есть Docker.
- docker build - Собрать образ Docker
- docker run - Запустить образ Docker в качестве контейнера
- docker commit - Сохранить контейнер Docker в качестве образа
- docker tag - Присвоить тег образу Docker

**Способы создания нового образа Docker**
- Команды Docker/ «От руки»
- Dockerfile – это текстовый файл, содержащий серию команд
- Dockerfile и инструмент управления конфигурацией
- Стереть образ и импортировать набор файлов

## Постигаем Docker
**Архитектура Docker**

Docker на хост­компьютере разделен на две части: **демон** с прикладным программным интерфейсом RESTful и **клиент**, который общается с демоном. Вы вызываете Docker ­клиент, чтобы получить информацию или дать инструкции демону. Демон – это сервер, который получает запросы и возвращает ответы от клиента по протоколу HTTP. Частный **реестр** Docker – это сервис, который хранит образы Docker.

## Демон Docker - контролирует доступ к Docker на вашем компью- тере, управляет состоянием контейнеров и образов, а также взаимодействует с внешним миром.

### Запустите демон Docker с открытым TCP адресом.
```
sudo docker daemon -H tcp://0.0.0.0:2375
определяет хост­сервер с помощью флага ­H, использует протокол TCP,
открывает все IP- интерфейсы (с 0.0.0.0) и стандартный порт сервера Docker (2375).
```
Подключиться снаружи
```
docker -H tcp://<your host's ip>:2375 <subcommand>
```
через переменную среды DOCKER_HOST
```
export DOCKER_HOST=tcp://<your host's ip>:2375
docker <subcommand>
```
### Запустить контейнер Docker в фоновом режиме как службу
- Используйте флаг -d в команде docker run 
```
docker run -d -i -p 1234:1234 --name daemon ubuntu:14.04 nc -l 1234
```
- Флаг -d запускает контейнер в качестве демона.
- Флаг -i дает этому контейнеру возможность взаимодействовать с вашим сеансом Telnet.
- С помощью флага -p вы «публикуете» порт 1234 из контейнера на хост.
- Флаг --name позволяет присвоить контейнеру имя, чтобы вы могли обратиться к нему позже.
- В конце вы запускаете простой прослушивающий эхо­сервер на порту 1234 с помощью netcat (nc).

Параметры флагов повторного запуска Docker:
- no - Не перезапускать при выходе контейнера
- always - Всегда перезапускать при выходе контейнера
- unless-stopped - Всегда перезагружать, но помнить о явной остановке
- on-failure[:max-retry] - Перезапускать только в случае сбоя
```
docker run -d --restart=always ubuntu echo don
```
### Перемещение Docker в другой раздел
Запустите демон Docker, указав новое местоположение с помощью флага -g
```
dockerd -g /home/dockeruser/mydocker
```
## Клиент Docker
Это то,что вы запускаете, когда набираете такие команды,как docker run или docker pull насвоем компьютере. Его задача - взаимодействовать сдемоном Docker посредством HTTP­запросов.

### Использование socat для мониторинга трафика Docker API
Надо отладить проблему с помощью команды Docker

Используйте программу для контроля сетевого трафика, чтобы проверять API­вызовы и создавать свои собственные.
```
socat -v UNIX-LISTEN:/tmp/dockerapi.sock,fork UNIX-CONNECT:/var/run/docker.sock &
```
- В этой команде -v делает вывод читаемым с указанием потока данных.
- Часть UNIX-LISTEN говорит socat прослушивать сокет Unix
- fork гарантирует, что socat не завершит работу после первого запроса
- UNIX-CONNECT сообщает socat подключиться к Unix­сокету Docker
- & указывает, что команда выполняется в фоновом режиме

Весь трафик, проходящий в каждом направлении, socat будет видеть, и он будет зарегистрирован на вашем терминале.

### Использование Docker в браузере
Запустите демон Docker с открытым портом и задействуйте совместное использование ресурсов между разными источниками, а затем обслуживайте репозиторий Docker­ терминала на выбранном вами веб­сервере.
```
git clone https://github.com/aidanhs/Docker-Terminal.git
cd Docker-Terminal
python2 -m SimpleHTTPServer 8000
```
### Использование портов для подключения к контейнерам
Флаг ­p для отображения порта контейнера в свой хост-­компьютер.
```
docker rnu -d -p 10001:80 --name blog1 tutum/wordpress
```
### Разрешение связи между контейнерами
Разрешить связь между контейнерами для внутренних целей.
- Используйте пользовательские сети, чтобы контейнеры могли взаимодействовать друг с другом.
```
docker network create my_network
```
По умолчанию все контейнеры, которые вы подключаете к этой сети, смогут видеть друг друга по их именам.
```
docker network connect my_network blog1
docker run -it --network my_network ubuntu:16.04 bash
```
### Установление соединений между контейнерами для изоляции портов
Старый метод объяв­ления обмена данными между контейнерами – флаг соединений Docker.
- Установление соединений позволяет инкапсулировать и определять отношения между контейнерами, не подвергая сервисы сети хоста
```
docker run --name wordpress --link wp-mysql:mysql -p 10003:80 -d wordpress
```
Чтобы контейнеры могли быть соединены таким способом, их порты должны быть указаны как открытые при сборке образов. Это делается с помощью команды EXPOSE в файле сборки образа Dockerfile.
## Реестры Docker
Реестр Docker позволяет нескольким пользователям размещать и извлекать образы из центрального хранилища, используя RESTful API.
### Настройка локального реестра Docker
