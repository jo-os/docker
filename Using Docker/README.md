# Using Docker

## Что такое контейнеры и для чего они нужны

Контейнеры коренным образом изменяют способ разработки, распространения и функционирования программного обеспечения. Контейнеры (containers) представляют собой средства инкапсуляции приложения вместе с его зависимостями.

Контейнеры обладают некоторыми преимуществами, обеспечивающими такие варианты использования, которые трудно или невозможно реализовать в обычных виртуальных машинах:
- контейнеры совместно используют ресурсы основной ОС, что делает их на порядок более эффективными
- переносимость контейнеров обеспечивает потенциальную возможность устранения целого класса программных ошибок
- упрощенная сущность контейнера означает, что можно одновременно запускать десятки контейнеров
- контейнеры предоставляют преимущества установки ПО без необходимости развертывания его в облаке

## Docker и контейнеры
Еще несколько десятков лет назад в Unix-системах существовала команда chroot, обеспечивающаяпростейшую форму изоляции части файловой системы. С 1998 года в ОС Free-BSD появилась утилита jail, распространяющая изоляционные возможности chroot на процессы. Компания Google начала разаработку CGroups для ядра ОС Linux и приступила к перемещению своей инфраструктуры в контейнеры. Проект Linux Containers (LXC) был создан в 2008 году и вскоре объединил CGroups, пространства имен ядра, технологию chroot и некоторые другие технологии, чтобы предоставить полностью завершенное решение по обеспечению контейнеризации. В 2013 году Docker стал последним штрихом в общей картине состояния
контейнеризации.

Платформа Docker состоит из двух отдельных компонентов: Docker Engine и Docker Hub
- **Docker Engine** предоставляет эффективный и удобный интерфейс для запуска контейнеров
- **Docker Hub** предоставля ет огромное количество образов контейнеров с открытым доступом для загрузки

## Первые шаги
```
docker run debian echo "Hello World"
```
- команда docker run инициализирует запуск контейнеров
- debian – это имя образа
- после загрузки и проверки образа Docker помещает его в работающий контейнер и выполняет заданную команду echo "Hello World" внутри контейнера

Можно запустить командную оболочку shell внутри контейнера, выполнив следующую команду:
```
docker run -i -t debian /bin/bash
```
- флаги -i и -t сообщают Docker, что необходимо создать сеанс интерактивной работы на подключаемом терминальном устройстве tty
- команда /bin/bash инициализирует командную оболочку bash
- при выходе из командной оболочки контейнер прекратит работу

**Основные команды**
- -h - задаем имя хоста
- docker ps - позволяет узнать подробности обо всех контейнерах, работающих в текущий момент
- docker ps -a - список всех контейнеров, включая остановленные
- docker inspect "id or name" - больше информации о конкретном контейнере
- - можно искать с утилитой grep или аргументом --format
```
docker inspect --format {{.NetworkSettings.IPAddress}} test_container
```
- docker diff "id or name" - выведет список файлов, измененных в работающем контейнере
- docker logs "id or name" - список всех событий, произошедших внутри заданного контейнера
- docker start "id or name" - запуск остановленного контейнера
- docker rm "id or name" - удаление контейнера
- docker rm -v $(docker ps -aq -f status=exited) - удалить все остановленные контейнеры
- - -v - позволяет удалить все тома (разделы), управляе мые Docker, на которые не ссылаются какие-либо другие контейнеры
- флаг --rm - удалияет остановленный контейнер и созданную на время его существования соответствующую файловую систему
```
docker run -it --name cowsay --hostname cowsay debian bash
docker commit cowsay test/cowsayimage
```
- docker commit "id or name" repositpry-name/image-name - превращения контейнера в образ, не имеет значения, работает контейнер или он остановлен

## Создание образов из файлов Dockerfile
**Dockerfile** – это обычный текстовый файл, содержащий набор операций, которые могут быть использованы для создания Docker-образа.
```
FROM debian:wheezy
RUN apt-get update && apt-get install -y cowsay fortune
```
- Инструкция FROM - определяет базовый образ ОС, является строго обязательной для всех файлов Dockerfile
- Инструкции RUN определяют команды, выполняемые в командной оболочке внутри данного образа
- docker build - создать образ, выполняется в том же каталоге, где расположен Dockerfile
```
docker build -t test/cowsay-dockerfile .
docker run t
est/cowsay-dockerfile /usr/games/cowsay "Moo"
```
- Инструкция ENTRYPOINT - позволяет определить выполняемый файл, который будет вызываться для обработки любых аргументов, переданных в команду docker run
```
ENTRYPOINT ["/usr/games/cowsay"]
```
